<link rel="import" href="../../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../app-rules/app-rules.html">
<link rel="import" href="../element-for-in/element-for-in.html">
<dom-module id="page-machine">
    <template>
        <style is="custom-style" include="tags-and-labels"></style>
        <style is="custom-style" include="info-table-style"></style>
        <style include="shared-styles">
        :host {
            background: #fafafa;
        }

        #content {
            overflow: auto;
            -webkit-overflow-scrolling: touch;
            padding: 20px;
        }

        .paper-header h2 {
            @apply(--layout-flex-none);
        }

        .machine-ip {
            margin: 0;
        }
        paper-material {
            padding-bottom: 0;
        }
        paper-material > h2 {
            line-height: initial !important;
            margin-bottom: 0;
            cursor: pointer;
        }
        ::content {
            table {
            table-layout: fixed !important;
            word-break: break-all !important;
            word-wrap: break-word !important;
        }
        ::content table tr  {
            overflow: hidden !important;
            white-space: normal !important;
            word-break: break-all !important;
            word-wrap: break-word !important;
        }


        </style>
        <paper-drawer-panel id="drawerPanel" responsive-width="900px" narrow="{{narrowMode}}" drawer-width="272px" disable-edge-swipe>
            <app-sidebar tag="[[tag]]" sections="{{sections}}" current="machines" drawer></app-sidebar>
            <paper-header-panel id="container" main>
                <div class="paper-header">
                    <paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>
                    <h2>Machine: [[machine.name]]</h2>
                    <div class="label flex">
                        <span class$="[[machine.state]]" title="machine state">[[machine.state]]</span>
                    </div>
                    <app-bar class="horizontal layout center end-justified" query="{{q}}"></app-bar>
                    <paper-icon-button icon="icons:sort"></paper-icon-button>
                    <app-user-menu model="[[model]]"></app-user-menu>
                </div>
                <div id="content" class="page">
                    <paper-material class="info-card" >
                        <h2 style$="[[_getHeaderStyle(section.color)]]" on-tap="toggle">Basic Info</h2>
                        <iron-collapse id="collapse" opened>
                            <div class="card-content">
                                <table class="info-table">
                                    <template is="dom-if" if="[[machine.public_ips]]">
                                        <tr>
                                            <td>
                                                Public IPs
                                            </td>
                                            <td>
                                                <template is="dom-repeat" items="[[machine.public_ips]]">
                                                    <p class="machine-ip">[[item]]</p>
                                                </template>
                                            </td>
                                        </tr>
                                    </template>
                                    <template is="dom-if" if="[[machine.private_ips]]">
                                        <tr>
                                            <td>
                                                Private IPs
                                            </td>
                                            <td>
                                                <template is="dom-repeat" items="[[machine.private_ips]]">
                                                    <p class="machine-ip">[[item]]</p>
                                                </template>
                                            </td>
                                        </tr>
                                    </template>
                                    <template is="dom-if" if="[[machine.df]]">
                                        <tr>
                                            <td colspan="2">
                                                <div class="df">[[machine.df]]</div>
                                            </td>
                                        </tr>
                                    </template>
                                    <template is="dom-if" if="[[machine.extra.dns_name]]">
                                        <tr>
                                            <td>
                                                DNS Name
                                            </td>
                                            <td>
                                                [[machine.extra.dns_name]]
                                            </td>
                                        </tr>
                                    </template>
                                    <template is="dom-if" if="[[machine.extra.launchdatetime]]">
                                        <tr>
                                            <td>
                                                Launch Date
                                            </td>
                                            <td>
                                                [[machine.extra.launchdatetime]]
                                            </td>
                                        </tr>
                                    </template>
                                </table>
                            </div>
                        </iron-collapse>
                    </paper-material>
                    <paper-material class="info-card">
                        <h2 style$="[[_getHeaderStyle(section.color)]]" on-tap="togglefull">Full Metadata List</h2>
                        <iron-collapse id="collapsefull" opened>
                            <div class="card-content">
                                <element-for-in content="[[machine.extra]]"></element-for-in>
                            </div>
                        </iron-collapse>
                    </paper-material>

                    <app-rules></app-rules>

                </div>
                <div class="absolute-bottom-right">
                    <app-fab></app-fab>
                </div>
            </paper-header-panel>
        </paper-drawer-panel>
    </template>
</dom-module>
<script>

Polymer({
    is: 'page-machine',

    properties: {
        model: {
            type: Object,
            notify: true
        },
        router: Object,
        pageTitle: {
            type: String
        },
        params: {
            type: Object,
            notify: true
        },
        machine: {
            type: Object,
            computed: '_computeMachine(params)',
            notify: true
        },
        sections: {
            type: Array,
            notify: true
        },
        section: {
            type: Object
        },
        tag: {
            type: String,
            value: ""
        }
    },
    _computeMachine: function(params) {
        return this.model.machinesArray.find(function(machine) {
            return machine.uuid == params.uuid;
        }, this);
    },
    _isEqual: function(a, b) {
        return a === b;
    },
    _getColor: function() {
        return this.section && this.section.color ? this.section.color : '';
    },
    addKey: function(_, params) {
        console.log("clicked addKey");
    },
    rename: function(_, params) {
        console.log("clicked rename");
    },
    restart: function(_, params) {
        console.log("clicked restart");
    },
    shutdown: function(_, params) {
        console.log("clicked shutdown");
    },
    destroy: function(_, params) {
        console.log("clicked destroy");
    },
    _getHeaderStyle: function(color) {
        return 'background-color: ' + color + '; color: #fff;';
    },
    toggle: function() {
      this.$.collapse.toggle();
    },
    togglefull: function() {
      this.$.collapsefull.toggle();
    }
});
</script>
